# 线程池嵌套

## 一、线程池嵌套问题（一个接口多次异步，共用线程池问题）
1. 问题描述：
   - A线程调用B线程，A线程依赖B线程的返回值，<font color='yellow'>A线程与B线程共用一个线程池</font>，在请求量比较低的时候是没有问题的；
   - 当请求量增多后，例如线程池大小只有16，线程池将所有请求先分配给A线程，A线程跑到中间发现要再创建B线程异步处理，但是这时候线程池已经饱和，将新任务放在阻塞队列中
   - 就出现了A线程需要创建B线程，等待B线程返回结果；B线程因为A线程占用了线程池的全部可执行资源，B线程无法被执行，出现了相互等待的情况
   - 当然，也没有设置代码执行的超时时间，导致线程完全卡死
2. 问题发现：
   - 本地debug的时候没有问题
   - 线上压测时，由于请求量瞬间放大，A线程将线程池全部资源占用掉，B线程无法创建
3. 问题解决：
   - 最直接的解决方案：分别用不同的线程池实现对应的功能，也就是A、B线程池不再共用一个线程池

## 二、线程池嵌套问题（两个接口分别异步，分用线程池问题）
1. 问题描述：
   - A接口依赖线程池BIZ_POOL，B接口也依赖线程池BIZ_POOL，两个接口共用一个线程池
   - 当A接口的请求打的很满的时候，B接口的请求就只能排队，一直导致B接口的请求无法继续
2. 问题解决：
   - 分用不同的线程池










参考文档：
1. https://blog.csdn.net/notfound4043/article/details/142451374