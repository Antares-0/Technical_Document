# 分布式事务

|              方案              |           特点            |  注意  |
|:----------------------------:|:-----------------------:|:----:|
|            `2PC`             |       返回指定下标处的字符        |      |
|            `3PC`             |      按照字典顺序比较两个字符串      |      |
|           `equals`           |    判断两个字符串的长度和内容是否相等    |      |
|          `indexOf`           | 返回字符串中某个字符或子字符串首次出现的下标  |      |
|        `lastIndexOf`         | 返回字符串中某个字符或子字符串最后出现的下标  |      |
|           `length`           |        返回字符串的长度         |      |
|           `split`            | 将字符串按照指定的分隔符进行分割，返回一个数组 |      |
|         `substring`          |       按照下标截取子字符串        |      |
| `toLowerCase / toUpperCase`  |    将字符串中的所有字母变为大写或小写    |      |

## 一、2PC
1. 概念：两阶段提交
   - 准备阶段：协调者节点询问所有参与者是否准备好提交事务
   - 提交阶段：如果所有节点都准备好了，就直接提交事务；有一个节点没准备好，就直接回滚
2. 优点：
   - 原子性保证：可以保证所有的事务要么成功，要么失败
   - 简单直接，容易理解
3. 缺点：
   - 资源锁定：准备阶段，所有资源都在被锁定的状态等待外部触发，不利于高并发的实现
   - 单点故障：如果提交阶段协调者出现了问题，其他节点都在阻塞等待
   - 业务恢复难度大：业务上不好恢复，难以确定之前的状态
4. 实际业务场景

## 二、3PC
1. 概念：三阶段提交，是两阶段提交的改进版本
   - CanCommit阶段
     - 协调者：询问所有节点，能不能提交，等待回应
     - 参与者：可以提交，就返回Yes并进入预备状态；不能提交，返回No
   - PreCommit阶段：
     - 协调者：如果全部返回Yes，协调者发送PreCommit请求给所有参与者，进入Prepared状态；有任何参与者返回No，协调者发送abort请求
     - 参与者：收到preCommit请求后，执行事务但不提交，返回给协调者ACK并等待最终指令
   - DoCommit阶段：
     - 协调者：收到所有人的ACK，进入DoCommit阶段，发送commit给所有参与者
     - 参与者：将事务提交，释放资源并向协调者发送完成消息
2. 优点：
   - 比2PC提供了更好的容错性并减少了阻塞时间
3. 缺点：
   - 复杂性：比2PC更复杂，需要更多的消息交换和更多的状态管理
   - 性能开销：引入了额外的阶段和网络通信，导致了更大的性能开销
4. 实际业务场景

## 三、TCC
1. 概念：Try - Confirm - Cancel三阶段
   - Try：检查各个节点是否正确，如果正确锁住资源
   - Confirm：如果各个节点都ready，执行操作；如果没有，就走cancel
   - Cancel：如果有一个资源锁定失败，就进行取消
2. 优点：
   - 解决了2PC的单点故障问题，2PC等待协调者的信息
3. 缺点：


## 四、分布式补偿事务Saga
1. 



参考资料
1. https://blog.csdn.net/weixin_48321993/article/details/135243810