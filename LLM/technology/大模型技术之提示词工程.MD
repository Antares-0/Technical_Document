# 大模型技术之提示词工程

## 一、提示词工程
1. 提示词（prompt）：是指在使用LLM时，用户向模型提供的输入，用于引导模型生成特定类型的输出
2. 提示词工程（Prompt Engineering）：涉及到提示词的设计、优化、上下文管理以及大模型交互的策略，例如
   - 格式设计：确定指令结构
   - 内容优化：通过迭代测试调整措辞，提升准确性
   - 上下文整合：利用历史对话或者外部知识提升连贯性和准确性
3. 提示词工程的重要性
   - 能够在不进行大模型微调的情况下调整输出，使用成本非常低
   - 能够提升并优化模型的返回效果
4. 提示词工程主要考虑哪些因素？
   - 指示：想要模型执行的特定任务或者指令
   - 上下文：包含外部信息或者额外的上下文信息，引导模型更好响应
   - 例子：通过给出具体示例来展示期望的输出格式或者风格
   - 输入：用户输入的内容或者问题
   - 输出：指定输出的类型或者格式
5. deepSeek等推理大模型的引入降低了对提示词的高度依赖，但是提示词工程依然有它自己的作用
   - 从“指令拆分”到“目标导向”
     - 传统指令型模型：需明确步骤（如“先分析市场，再制定策略”），依赖CoT（思维链）提示
     - 推理型模型：只需提供目标和背景（如“为环保电商设计市场进入策略”），模型自主推导路径，比如：
       - 差提示：“分三步分析特斯拉财报风险”→ 限制模型创造力；
       - 优提示：“分析特斯拉2023年财报隐含风险，考虑市场、供应链和政策”→ 激发模型深度关联能力。 
   - 高级提示技巧的进化
     - 元提示（Meta-Prompting）：让模型自我优化提示词（如“请优化以下提示词以更好完成XX任务”）
     - 提示词缓存（Prompt Caching）：在长上下文场景中复用已验证的高效提示，降低计算成本；
     - 多模型协作：结合推理型模型（创造性任务）与指令型模型（稳定性任务），通过提示工程实现优势互补。 
   - 业务落地的关键保障 
     - 精准性需求：医疗、金融等领域需严格规避“幻觉”，依赖提示工程约束输出逻辑（如“引用最新医学指南”）
     - 经济性考量：通过提示优化减少API调用次数（如用RAG检索增强减少模型计算量）。

## 二、提示词工程的分类
1. 直接提示
   - 零样本：zero-shot
     - 定义：零样本提示是指直接给模型一个任务，不提供任何示例，让模型直接生成答案。
     - 原理：利用模型的泛化能力理解新任务。
     - 优势：无需准备大量的训练数据，节省时间和资源。
     - 适用场景：适用于模型已经具备一定知识储备的任务，如常识问答、简单推理等。
     - 示例：提示词：请解释什么是人工智能。输出：人工智能是研究、开发用于模拟、延伸和扩展人的智能的理论、方法、技术及应用系统的一门新的技术科学。
   - 少样本：few-shot
     - 定义：少样本提示是给模型提供少量的示例，帮助模型理解任务的要求，从而更好地生成答案。
     - 原理：通过模式模仿降低任务模糊性。
     - 关键要素：示例的质量和相关性对结果影响较大。
     - 适用场景：适用于需要一定上下文理解或特定格式输出的任务，如文本分类、句子改写等。
     - 示例：提示词：请将以下句子翻译成英文：示例1：好的，我来试试。-> Okay, I’ll give it a shot. 示例2：这很简单。-> This is very simple. 请将“我今天很高兴”翻译成英文。输出：I am very happy today.
   - 行动与反思：act-react
     - 定义：ReAct将推理与行动结合在一起，利用LLMs解决各种语言推理和决策任务。
     - 原理：通过交替生成与任务相关的口头推理轨迹和行动，使模型能够执行动态推理以构建和修改行动的高层计划。
     - 适用场景：适用于需要动态推理和决策的任务，如复杂问题解决、多步骤任务执行等。
     - 示例：提示词：请解决以下问题，并展示你的推理过程和行动。问题：小明有10元钱，他想买一支笔和一个笔记本。笔的价格是3元，笔记本的价格是7元。他能买下这两样东西吗？输出：首先，我需要计算小明购买这两样东西所需的总金额：3元 + 7元 = 10元。 然后，我比较小明的钱和所需总金额：10元 = 10元。 最后，得出结论：小明能买下这两样东西。
2. 链式提示
   - 思维链：cot
     - 定义：COT提示是引导模型逐步进行推理，将复杂问题分解成多个中间步骤，模拟人类的推理过程
     - 原理：通过让模型展示其推理过程，提高多步推理和逻辑分析类任务的表现。
     - 适用场景：适用于需要复杂推理的任务，如数学问题解决、逻辑推理等。
     - 示例：提示词：这组数中的奇数加起来是偶数：4、8、9、15、12、2、1。让我们逐步思考。输出：首先，找出所有的奇数：9、15、1。然后，将它们相加：9 + 15 + 1 = 25。最后，判断25是否为偶数，结果是False。
   - 思维树：tot
     - 定义：ToT是一种基于树状分支结构的推理框架，允许模型同时探索多种可能的解决方案路径，并通过动态评估和择优选择最终答案。其核心是模拟人类多路径思考与决策过程，结合搜索算法（如深度优先搜索DFS、广度优先搜索BFS）和评估机制，解决复杂问题。 
     - 原理：多路径生成：将问题分解为多个中间步骤，每个步骤生成多个候选方案（如数学问题的不同解法或战略规划的不同路径）。
     - 动态评估与筛选：通过自评分或外部工具验证路径可行性，保留高价值分支并剪枝低效路径。
     - 搜索与收敛：利用树状结构管理和回溯路径，最终收敛到最优解。
     - 适用场景：需要战略规划或创造性发散的任务：如数独解谜、战略决策、创意写作；高不确定性场景：例如复杂游戏策略（围棋、国际象棋）、多因素影响的商业决策。
     - 示例：解决数独问题
   - 自我反思：reflexion
     - 定义：Reflexion是一种通过自我验证与外部反馈结合的迭代优化机制，模型在生成初步答案后，利用批判性评估修正错误，最终输出高可靠性结果。其本质是强化学习框架，结合环境反馈与内部推理。
     - 原理：
       - 生成-评估闭环：
         - 初步输出：基于任务生成初始答案（如代码、法律条文草案）
         - 多维度评估：检查逻辑漏洞（如代码语法错误）、事实矛盾（如法律条文与现有法规冲突）
         - 迭代修正：根据评估结果调整输出，可能涉及多轮优化
       - 外部工具整合：调用编译器、数据库等验证答案可行性（如执行代码检查报错）
     - 适用场景：
       - 高精度要求的修正任务：如代码Debug、法律文书修订、学术论文逻辑校验
       - 动态环境下的决策：例如实时数据分析纠偏、机器人动作路径优化。 
     - 示例
     ```txt
     提示词：
     请编写一个Python函数，计算斐波那契数列的第n项，并确保处理边界条件。
     输出迭代过程：
     1. 初始答案：Python def fibonacci(n): if n <= 1: return n else: return fibonacci(n-1) + fibonacci(n-2)
     2. 评估：问题1：递归效率低，n较大时栈溢出。问题2：未处理n为负数的情况。
     3. 修正后答案：Python def fibonacci(n): if n < 0: raise ValueError(“n必须为非负整数”) a, b = 0, 1 for _ in range(n): a, b = b, a + b return a
     ```
3. 生成类提示
   - 最少到最多提示：LTM
     - 定义：LTM提示是一种策略，通过从简单到复杂的方式引导模型，先解决简单的问题，再逐步增加难度。
     - 策略：帮助模型逐步建立对任务的理解，提高解决复杂问题的能力
     - 适用场景：适用于需要逐步引导模型理解任务的场景，如复杂文本生成、多步骤推理等
     - 示例
     ```txt
     提示词：
     第一步：请列出三个水果的名称。输出：苹果、香蕉、橙子。 
     第二步：请描述苹果的外观特征。输出：苹果通常是红色或绿色的，形状呈圆形，表面光滑。 
     第三步：请根据以上信息，写一段关于苹果的描述。 
     输出：苹果是一种常见的水果，通常呈红色或绿色，形状为圆形，表面光滑。它不仅美味可口，而且富含营养。
     ```
   - 知识生成：generate knowledge
     - 定义：Generate Knowledge 要求模型在回答问题时先生成与任务相关的知识片段（如事实、规则、原理等），再基于这些知识生成最终答案。其核心是通过预先生成的结构化知识提升模型在复杂推理任务中的准确性和逻辑性。、
     - 原理：
       - 知识生成：模型根据任务需求生成相关背景知识（例如科学原理、行业规则或程序性步骤），形成辅助推理的信息库
       - 知识整合：将生成的知识片段与问题结合，引导模型基于知识库进行逻辑推理和答案生成
       - 置信度筛选：通过评估生成知识的可靠性（如模型自评分或外部验证），选择高置信度知识用于最终决策
     - 适用场景：
       - 需要背景知识支撑的任务：如科学问题解答、技术文档撰写、法律条文分析
       - 常识推理类任务：例如解释物理现象、验证历史事件因果关系
     - 示例
     ```txt
     提示词：
     量子计算的核心原理是什么？请先列出三大原理，再解释其应用场景。
     输出：
     生成的知识:
     1.量子叠加（Qubit可同时处于0和1状态）2.量子纠缠（粒子状态相互关联）3.量子隧穿（粒子穿越势垒）
     ```
   - 自动提示：Automatic Prompt Engineer
     - 定义：Automatic Prompt Engineer（APE）是一种通过模型自动生成、测试和优化提示词的框架，利用搜索算法（如贝叶斯优化）和模型自反馈，替代人工设计提示词的过程
     - 原理：
       - 候选生成：由模型生成多种候选提示词（如通过逆向推理或任务示例填充模板）
       - 动态评估：基于任务执行结果（如准确率）或模型对数概率评分，筛选最优提示词
       - 迭代优化：采用蒙特卡洛搜索或多臂老虎机算法，在优质提示词附近生成语义变体并重复评估，直至收敛。
     - 原理：
       - 候选生成：由模型生成多种候选提示词（如通过逆向推理或任务示例填充模板）
       - 动态评估：基于任务执行结果（如准确率）或模型对数概率评分，筛选最优提示词
       - 迭代优化：采用蒙特卡洛搜索或多臂老虎机算法，在优质提示词附近生成语义变体并重复评估，直至收敛
     - 适用场景：
       - 大规模提示词优化：如企业级AI客服系统需快速适配多场景提示模板
       - 跨模型适配：需为不同LLM（如GPT-4、Claude）自动生成适配指令
     - 示例：
       ```txt
       提示词优化流程
       1. 初始指令：请解释机器学习中的过拟合现象。
       2. APE生成候选：
          “分步骤解释过拟合的定义、成因及解决方案。” 
          “用比喻说明过拟合，并对比训练集与测试集表现。”
       3. 最优选择：
       评估后选择：“过拟合指模型在训练集表现优异但测试集差。成因包括数据量不足或模型复杂度过高，可通过交叉验证或正则化解决。”
       ```
4. 图谱提示
   - 实体关系推理
     - 定义：知识图谱引导是一种通过结构化知识库（如三元组、实体关系网络）为模型提供背景知识，辅助其进行深度语义推理的提示工程技术。其核心是将知识图谱中的实体、关系、属性等结构化信息与问题结合，增强模型对复杂逻辑和隐性关联的理解能力。
     - 原理：
       - 知识注入：将知识图谱中的实体、关系、属性等结构化信息嵌入提示词，为模型提供明确的语义关联和领域背景
       - 路径推理：基于知识图谱的图结构，引导模型沿实体关系路径进行多跳推理（如从“贾宝玉”到“贾母”再到“家族权力结构”）
       - 动态筛选：结合知识图谱的图神经网络（GNN）技术，对候选推理路径进行权重评估，优先选择高置信度路径
     - 适用场景：
       - 需要深度语义关联的任务：如文学分析、法律案件推演、医疗诊断
       - 跨领域知识融合：例如金融风控（结合企业图谱与供应链数据）、跨学科研究（如历史事件与地理数据联动）
     - 示例：
       ```txt
       提示词：分析《红楼梦》中贾宝玉与林黛玉的关系，结合家族背景和事件线索生成人物关系图及关键事件影响分析
       输出：
         知识图谱构建：
         实体：贾宝玉（荣国府继承人）、林黛玉（姑苏林家嫡女）、贾母（家族权力核心）
         关系：贾宝玉与林黛玉为表兄妹（血缘关系）；贾母偏袒宝玉（权力影响）；黛玉寄居荣国府（社会地位差异）
       关键事件推理：
         元妃省亲事件：贾府地位提升→宝玉婚姻选择受政治影响→宝黛爱情受阻
         黛玉葬花：性格孤傲→与家族利益冲突→人际关系边缘化
         关系可视化：生成包含人物情感线、权力层级的事件影响图谱。
       ```
   - 知识图谱引导
5. 集成式提示
   - 检索增强生成：RAG
   - 多模态提示

    

示例：

提示词：

分析《红楼梦》中贾宝玉与林黛玉的关系，结合家族背景和事件线索生成人物关系图及关键事件影响分析。

输出：

知识图谱构建：实体：贾宝玉（荣国府继承人）、林黛玉（姑苏林家嫡女）、贾母（家族权力核心）关系：贾宝玉与林黛玉为表兄妹（血缘关系）；贾母偏袒宝玉（权力影响）；黛玉寄居荣国府（社会地位差异）

关键事件推理：

元妃省亲事件：贾府地位提升→宝玉婚姻选择受政治影响→宝黛爱情受阻

黛玉葬花：性格孤傲→与家族利益冲突→人际关系边缘化

关系可视化：生成包含人物情感线、权力层级的事件影响图谱。

2.实体关系引导推理

定义：

实体关系引导推理是通过显式定义实体间的关联规则（如因果关系、时空关联），约束模型的推理方向，解决高复杂度问题的方法。其特点是利用关系网络缩小搜索空间，提升推理效率。

原理：

1）关系建模：定义实体间关系类型（如“导致”“属于”“反对”），构建关系约束矩阵。

2）规则驱动：通过预置逻辑规则（如“若A导致B，则B发生时间晚于A”）限制无效推理分支。

3）动态剪枝：基于关系权重实时淘汰低相关性路径（如供应链中断分析中剔除无关企业节点）

适用场景：

• 多实体交互的复杂系统：如供应链风险预测、法律案件证据链分析。

• 时序依赖强的问题：例如流行病传播路径推演、历史事件因果关系验证。

示例：

提示词：

某企业供应链因台风中断，请基于实体关系分析潜在风险链：
实体：供应商A（芯片）、物流公司B、港口C
关系：A依赖B运输、B使用港口C、台风影响C运营

输出：

一级影响：港口C停运→物流公司B无法交货→供应商A库存耗尽（3天内）

二级扩散：

替代路径分析：若B切换至港口D，需评估D容量与海关效率

长尾风险：A客户转单竞品→市场份额永久性流失

决策建议：优先启用应急仓库库存，并与物流公司B协商空运方案。

4.5 集成式提示

1. RAG（检索增强生成）

定义：

RAG（Retrieval-Augmented Generation）是一种通过结合外部知识库检索与生成模型的技术框架，旨在提升生成内容的准确性和可信度。其核心是通过检索实时、动态的外部知识，弥补大模型训练数据局限性和时效性问题。

原理：

1）检索-增强-生成闭环：

**• 检索阶段：**利用向量数据库对用户查询进行语义编码，通过相似度匹配从知识库中召回相关文本片段（如文档、图表描述等）。

**• 增强阶段：**将检索结果与原始查询结合，构建包含上下文信息的提示词模板（如“根据以下资料回答：…”）。

**• 生成阶段：**大模型基于增强后的上下文生成答案，并验证答案与检索内容的一致性，减少“幻觉”风险。

3）技术融合：

• 结合文本清洗、向量嵌入（Embedding）和索引优化技术提升检索质量；

• 支持动态知识更新，无需重新训练模型即可适配新数据。

适用场景：

•高精度需求场景：法律条文分析、医疗诊断辅助（需引用最新医学指南）；

•私有化数据应用：企业内部知识库问答（如财务报告解读）；

•实时信息处理：新闻事件摘要生成、股票市场趋势预测。

示例：

提示词：

根据公司2024年财报数据，分析新能源汽车业务的市场份额变化趋势。

输出流程：

检索：从企业数据库召回2024年销量、竞品分析、行业白皮书等文档；

增强：构建提示词：“根据《2024年新能源汽车市场报告》，Q3特斯拉占比22%…请分析市场份额变化”；

生成：输出结构化分析：“2024年Q3公司新能源车市占率提升至18%（同比+5%），主要得益于东南亚市场扩张，但面临特斯拉价格战的竞争压力。”

2. 多模态提示

定义：

多模态提示是通过融合文本、图像、音频等多种输入形式，引导模型生成跨模态关联内容的技术。其本质是模拟人类多感官协同认知，提升复杂任务的解决能力。

原理：

特征对齐与融合：

•跨模态编码：使用CLIP等模型将图像/音频编码为与文本对齐的向量空间；

•联合表示学习：通过注意力机制整合多模态特征（如将产品图与文案关键词关联）。

动态交互机制：

• 支持时序对齐（如视频帧与语音解说同步）和空间关联（如图像区域与文本描述映射）。

适用场景：

•创意内容生成：广告文案+配乐建议（如运动鞋宣传片搭配电子音乐）；

•工业质检辅助：结合产品缺陷图片生成维修方案文本；

•教育交互：根据历史事件地图生成讲解音频与互动问答。

示例：

提示词：

参考这张智能手表产品图（图略），写一段电商文案并建议配乐风格。

输出：

1.多模态解析：
- 图像特征：圆形表盘、钛金属表带、健康数据屏显；
- 文本关键词：科技感、运动场景、精准监测。
  2.文案生成：
  “全新XX智能手表，钛金属机身诠释硬核美学，24小时心率血氧监测精准如医疗级设备。跑步时，实时轨迹映射与配速分析让你掌控每一公里。”
  3.配乐建议：
- 风格：电子音乐（科技感）+ 环境音效（森林风声增强户外联想）。

*六、未来提示词工程的核心方向*

1）从“人工设计”到“自动化优化”

• 自动提示工程（APE）：利用模型生成候选提示词，并通过A/B测试筛选最优方案（如谷歌OPRO框架提升数学题准确率8.4%）；

动态知识注入：结合知识图谱或实时数据库，实现提示词与外部信息的联动更新。

2）跨模态与场景适配

• 多模态提示：融合图像、语音等输入（如“根据产品图写文案并建议配乐”），需设计跨模态对齐机制；

• 行业专用模板：针对电商、法律等场景开发标准化提示库（如跨境文案优化模板）。








参考文档：
1. https://blog.csdn.net/m0_59164304/article/details/147950500
2. 