# Redis的大Key与热Key问题

## 一、Redis的大Key问题
1. 大Key问题是什么：
   当一个Redis键对应的Value值占用了较大的内存空间，或者是一个集合类型中的元素非常多，就可以称之为大Key。
   ```txt
   大Key的标准一般是：单个String的Value大于1MB
   ```
2. 大Key问题会产生什么影响：（内存、耗时、迁移）
   1. 占用太多的内存，导致Redis内存使用率过高，引发内存不足的错误；当系统希望分配一块空间的时候，可能会报错
   2. 操作耗时长，对大Key进行修改需要更多的时间进行读取、修改等，影响性能
   3. 数据迁移困难，大Key会需要更多的操作难度来备份或者迁移
3. 大Key问题怎么解决：（拆分、压缩、删除、监控）
   1. 拆分大Key：将大的Hash表拆分为小的Hash表，做数据存储；加一些前缀，将数据分散到多个key中
   2. 压缩大Key：如果是字符串类型的大Key，可以先用一些压缩算法对数据进行压缩
   3. 定期清理过期数据
   4. 做一些监控相关的内容


## 二、Redis的热Key问题
1. 热Key问题是什么：在同一个时间点上，Redis中的同一个Key被大量访问。
   ```txt
   热Key的标准一般是：1s内被访问了超过1000次
   ```
2. 热Key会产生什么影响：
   会导致流量过于集中，使得很多物理资源无法支撑；比如网络带宽、物理存储空间、数据库连接等。
3. 热Key问题怎么解决：（主要以事前预测和事中解决为主，<font color = 'yellow'>缓存、备份、拆分</font>）
   1. 事前预测：秒杀场景中，某些关键词必然是访问热点，提前做好准备
   2. 事中解决：
      1. 多级缓存：有些数据可以缓存在浏览器中，有的可以缓存在附近的CDN中，有些数据可以通过Redis等这类缓存框架进行缓存，还有一些可以通过服务器本地缓存进行
      2. 热Key备份：在多个服务器上进行缓存；在多个分片中把热Key都同步一份。
      3. 热Key拆分：热key拆分成多个key，在每一个key后面加一个后缀名，然后把这些key分散到多个阶段中；这样在客户端请求的时候，可以根据一定的规则计算得出一个固定的key，这样多次请求就会被分散到不同的节点上了。