# HTTP 与 TCP

## 一、计算机网络的模型
1. 所谓的计算机网络的模型，实际上仅仅是一种抽象。
2. 以HTTP请求为例，HTTP假定下层协议能够提供可靠的传输（例如TCP，或者加了某种机制的UDP），而这种可靠的传输实际上是建立在IP协议之上的，IP协议的本质就是根据IP地址进行数据的传输，IP协议不需要与目的主机建立好特定的通路，IP协议提供的是不可靠的数据包传输机制，也就是尽最大努力交付的数据包传输机制；IP数据包在到达的时候可能已经损坏或者乱序。
3. 简单来说，目前对计算机网络协议的理解如下
   > 物理层保证了机器之间是互相连接的，是有一条电磁信号通路可达的  
   > 数据链路层保证了导线两端的数据传输，本质上是点对点传输  
   > 网络层提供了路由和寻址的功能，使得两个终端之间可以互相连接并决定最佳路径  
   > 传输层提供了应用进程之间的端到端服务  
   > 应用层直接和应用程序耦合，代表了一种对下层资源的使用  
4. 举个例子：
   > 物理层确保了A和B机器之间确实是有一条实实在在的线可达的  
   > 数据链路层保证了导线两端的数据传输，本质上是点对点传输  
   > 网络层借助数据链路层提供的能力，为设备编码IP地址  
   > 传输层在网络层的基础之上，新加了重传、拥塞控制等各种功能，在两个指定的端口上进行数据通信  
   > 应用层规定了传输层要使用的端口，作为一种约定俗称的规范
5. 其实所谓的分层协议，不过是上一层对下一层的细化设计；  
   - 应用层计划使用HTTP协议发送“你好”，这实际上是说，可以向服务器的80端口发送请求建立针对目标服务器80端口的TCP连接来实现数据传输；  
   - 至于TCP协议依赖于IP协议而生存，TCP协议在IP协议的基础上，添加数据包的序号来保证最终收到数据是有序的，进而保证TCP承诺的可靠性；  
   - IP协议则是基于数据链路层的MAC地址进行的寻址，IP地址是一种逻辑上的抽象规范，而MAC地址是物理设备上的物理规范，利用ARP协议将MAC地址与IP地址绑定在一起，当IP层希望寻找某一个IP时，就先借助MAC层的物理地址进行广播，根据回复来实现IP寻址，因此IP层的实现离不开数据链路层的寻址过程；  
   - 数据链路层则是借助了物理层真实的电磁信号实现了信息的传输。
6. 换一种新的理解方式：
   - 所谓基于IP协议的TCP协议，就是在IP的内容中装载符合TCP格式规范的数据
   - 所谓基于TCP协议的HTTP协议，就是在TCP协议的内容中放上符合HTTP规范的数据

## 二、TCP与HTTP的关系
1. 在上层浏览器向服务器发送请求的过程中，HTTP请求与TCP三次握手、四次握手的联系究竟是怎样的？
   > 根据上述分析，HTTP实际上只不过是约定了要访问的端口号，TCP进行三次握手和四次挥手的目标端口号是HTTP协议规定的，因此可以理解为先进行了TCP的三次握手建立了TCP通信才发送的HTTP具体数据。
2. HTTP不仅仅局限于使用TCP，HTTP也可以借助UDP实现。

## 三、wireshark抓包真实数据结构
1. 案例（一个http帧的结构）
   ```txt
   0000   1e 00 00 00 60 08 08 00 03 50 06 40 00 00 00 00   ....`....P.@....
   0010   00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 00   ................
   0020   00 00 00 00 00 00 00 00 00 00 00 01 cc 9c 1f 90   ................
   0030   f2 ea b3 f0 64 89 bb e9 80 18 18 e3 03 58 00 00   ....d........X..
   0040   01 01 08 0a 69 2f 1e 09 d3 70 38 25 47 45 54 20   ....i/...p8%GET
   0050   2f 73 73 65 2f 63 68 61 74 20 48 54 54 50 2f 31   /sse/chat HTTP/1
   0060   2e 31 0d 0a 48 6f 73 74 3a 20 6c 6f 63 61 6c 68   .1..Host: localh
   0070   6f 73 74 3a 38 30 38 30 0d 0a 43 6f 6e 6e 65 63   ost:8080..Connec
   0080   74 69 6f 6e 3a 20 6b 65 65 70 2d 61 6c 69 76 65   tion: keep-alive
   0090   0d 0a 43 61 63 68 65 2d 43 6f 6e 74 72 6f 6c 3a   ..Cache-Control:
   00a0   20 6d 61 78 2d 61 67 65 3d 30 0d 0a 73 65 63 2d    max-age=0..sec-
   00b0   63 68 2d 75 61 3a 20 22 43 68 72 6f 6d 69 75 6d   ch-ua: "Chromium
   00c0   22 3b 76 3d 22 31 34 30 22 2c 20 22 4e 6f 74 3d   ";v="140", "Not=
   00d0   41 3f 42 72 61 6e 64 22 3b 76 3d 22 32 34 22 2c   A?Brand";v="24",
   00e0   20 22 47 6f 6f 67 6c 65 20 43 68 72 6f 6d 65 22    "Google Chrome"
   00f0   3b 76 3d 22 31 34 30 22 0d 0a 73 65 63 2d 63 68   ;v="140"..sec-ch
   0100   2d 75 61 2d 6d 6f 62 69 6c 65 3a 20 3f 30 0d 0a   -ua-mobile: ?0..
   0110   73 65 63 2d 63 68 2d 75 61 2d 70 6c 61 74 66 6f   sec-ch-ua-platfo
   0120   72 6d 3a 20 22 6d 61 63 4f 53 22 0d 0a 55 70 67   rm: "macOS"..Upg
   0130   72 61 64 65 2d 49 6e 73 65 63 75 72 65 2d 52 65   rade-Insecure-Re
   0140   71 75 65 73 74 73 3a 20 31 0d 0a 55 73 65 72 2d   quests: 1..User-
   0150   41 67 65 6e 74 3a 20 4d 6f 7a 69 6c 6c 61 2f 35   Agent: Mozilla/5
   0160   2e 30 20 28 4d 61 63 69 6e 74 6f 73 68 3b 20 49   .0 (Macintosh; I
   0170   6e 74 65 6c 20 4d 61 63 20 4f 53 20 58 20 31 30   ntel Mac OS X 10
   0180   5f 31 35 5f 37 29 20 41 70 70 6c 65 57 65 62 4b   _15_7) AppleWebK
   0190   69 74 2f 35 33 37 2e 33 36 20 28 4b 48 54 4d 4c   it/537.36 (KHTML
   01a0   2c 20 6c 69 6b 65 20 47 65 63 6b 6f 29 20 43 68   , like Gecko) Ch
   01b0   72 6f 6d 65 2f 31 34 30 2e 30 2e 30 2e 30 20 53   rome/140.0.0.0 S
   01c0   61 66 61 72 69 2f 35 33 37 2e 33 36 0d 0a 41 63   afari/537.36..Ac
   01d0   63 65 70 74 3a 20 74 65 78 74 2f 68 74 6d 6c 2c   cept: text/html,
   01e0   61 70 70 6c 69 63 61 74 69 6f 6e 2f 78 68 74 6d   application/xhtm
   01f0   6c 2b 78 6d 6c 2c 61 70 70 6c 69 63 61 74 69 6f   l+xml,applicatio
   0200   6e 2f 78 6d 6c 3b 71 3d 30 2e 39 2c 69 6d 61 67   n/xml;q=0.9,imag
   0210   65 2f 61 76 69 66 2c 69 6d 61 67 65 2f 77 65 62   e/avif,image/web
   0220   70 2c 69 6d 61 67 65 2f 61 70 6e 67 2c 2a 2f 2a   p,image/apng,*/*
   0230   3b 71 3d 30 2e 38 2c 61 70 70 6c 69 63 61 74 69   ;q=0.8,applicati
   0240   6f 6e 2f 73 69 67 6e 65 64 2d 65 78 63 68 61 6e   on/signed-exchan
   0250   67 65 3b 76 3d 62 33 3b 71 3d 30 2e 37 0d 0a 53   ge;v=b3;q=0.7..S
   0260   65 63 2d 46 65 74 63 68 2d 53 69 74 65 3a 20 6e   ec-Fetch-Site: n
   0270   6f 6e 65 0d 0a 53 65 63 2d 46 65 74 63 68 2d 4d   one..Sec-Fetch-M
   0280   6f 64 65 3a 20 6e 61 76 69 67 61 74 65 0d 0a 53   ode: navigate..S
   0290   65 63 2d 46 65 74 63 68 2d 55 73 65 72 3a 20 3f   ec-Fetch-User: ?
   02a0   31 0d 0a 53 65 63 2d 46 65 74 63 68 2d 44 65 73   1..Sec-Fetch-Des
   02b0   74 3a 20 64 6f 63 75 6d 65 6e 74 0d 0a 41 63 63   t: document..Acc
   02c0   65 70 74 2d 45 6e 63 6f 64 69 6e 67 3a 20 67 7a   ept-Encoding: gz
   02d0   69 70 2c 20 64 65 66 6c 61 74 65 2c 20 62 72 2c   ip, deflate, br,
   02e0   20 7a 73 74 64 0d 0a 41 63 63 65 70 74 2d 4c 61    zstd..Accept-La
   02f0   6e 67 75 61 67 65 3a 20 7a 68 2d 43 4e 2c 7a 68   nguage: zh-CN,zh
   0300   3b 71 3d 30 2e 39 0d 0a 43 6f 6f 6b 69 65 3a 20   ;q=0.9..Cookie:
   0310   49 64 65 61 2d 33 62 65 37 39 36 65 38 3d 33 62   Idea-3be796e8=3b
   0320   37 65 66 64 31 65 2d 62 65 30 36 2d 34 64 39 65   7efd1e-be06-4d9e
   0330   2d 39 30 33 36 2d 64 66 65 34 38 30 35 63 61 33   -9036-dfe4805ca3
   0340   39 31 3b 20 47 6f 6c 61 6e 64 2d 65 63 66 36 64   91; Goland-ecf6d
   0350   35 36 65 3d 36 66 37 65 32 34 31 62 2d 64 36 36   56e=6f7e241b-d66
   0360   37 2d 34 30 33 62 2d 61 62 31 37 2d 31 37 63 31   7-403b-ab17-17c1
   0370   38 30 36 63 39 64 34 65 0d 0a 0d 0a               806c9d4e....
   ```
2. 整体结构类似堆栈，一层套一层，所以一个HTTP请求，实际上是基于TCP和IP底层的能力的
   ```txt
   [    IP     [      TCP      [        HTTP         ]  ]  ]
   | -------------------- 整体是IP协议 --------------------- |
               | ------------ 内部是TCP协议 ------------ |
                               | -- 最内部HTTP协议 -- ｜
   ```

## 四、TCP连接状态标识
1. SYN 表示建立连接
2. FIN 表示关闭连接
3. ACK 表示响应
4. PSH 表示有 DATA 数据传输
5. RST 表示连接重置



参考资料
1. TCP连接状态标识：https://blog.csdn.net/u013669912/article/details/145103924